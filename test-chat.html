<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chat Feature</title>
</head>
<body>
    <h1>Chat with Document Test</h1>
    <div id="test-results"></div>
    
    <script src="env-config.js"></script>
    <script src="gemini-service.js"></script>
    <script>
        async function testGeminiService() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<p>Testing Gemini Service...</p>';
            
            try {
                // Test service initialization
                const service = new GeminiService();
                results.innerHTML += '<p>‚úÖ GeminiService initialized successfully</p>';
                
                // Test API key loading
                if (window.envConfig && window.envConfig.GEMINI_API_KEY) {
                    results.innerHTML += '<p>‚úÖ API key found in configuration</p>';
                } else {
                    results.innerHTML += '<p>‚ùå API key not found in configuration</p>';
                }
                
                // Test document chat with mock data
                const mockDocument = {
                    title: 'Test Document',
                    content: 'This is a test document about KMRL project management.',
                    contentML: '‡¥á‡¥§‡µç KMRL ‡¥™‡µç‡¥∞‡µã‡¥ú‡¥ï‡µç‡¥ü‡µç ‡¥Æ‡¥æ‡¥®‡µá‡¥ú‡µç‡¥Æ‡µÜ‡¥®‡µç‡¥±‡¥ø‡¥®‡µÜ‡¥ï‡µç‡¥ï‡µÅ‡¥±‡¥ø‡¥ö‡µç‡¥ö‡µÅ‡¥≥‡µç‡¥≥ ‡¥í‡¥∞‡µÅ ‡¥ü‡µÜ‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥°‡µã‡¥ï‡µç‡¥Ø‡µÅ‡¥Æ‡µÜ‡¥®‡µç‡¥±‡¥æ‡¥£‡µç.'
                };
                
                results.innerHTML += '<p>üîÑ Testing AI response...</p>';
                
                const response = await service.chatWithDocument("What is this document about?", mockDocument);
                
                if (response && response.length > 0) {
                    results.innerHTML += '<p>‚úÖ AI response received successfully</p>';
                    results.innerHTML += `<div style="border: 1px solid #ccc; padding: 10px; margin: 10px 0;"><strong>AI Response:</strong><br>${response}</div>`;
                } else {
                    results.innerHTML += '<p>‚ùå AI response was empty or invalid</p>';
                }
                
            } catch (error) {
                console.error('Test error:', error);
                results.innerHTML += `<p>‚ùå Error during testing: ${error.message}</p>`;
            }
        }
        
        // Run test when page loads
        window.addEventListener('load', testGeminiService);
    </script>
</body>
</html>